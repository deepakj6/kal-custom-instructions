<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Kubernetes Domains - Deepdive</title>
    <script src="clipboard.min.js"></script>
    <script src="jquery-3.5.1.min.js"></script>
    <script src="velocity.min.js"></script>
    <link rel="stylesheet" href="font-awesome.min.css" />
    <script src="jquery-3.5.1.min.js"></script>
    <script src="copy.js"></script>
<style>
/* Based on Flatly from Bootswatch (https://bootswatch.com/flatly/) */
@import url("//fonts.googleapis.com/css?family=Lato:400,700,400italic");

/* document body (contains all content) */
body {
  font-family: "Lato", "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 15px;
  line-height: 1.42857143;
  color: #2c3e50;
  background-color: #ffffff;
  margin-left: 10%;
  margin-right: 10%;
}

/* document header (contains title etc) */
#header {
  width: 100%;
}
#header>h1 {
  border-bottom: 1px solid #ddddd8;
  padding-bottom: 8px;
}

/* headings */
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: "Lato", "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-weight: 400;
  line-height: 1.1;
  color: inherit;
}
h1,
h2,
h3 {
  margin-top: 21px;
  margin-bottom: 10.5px;
}
h4,
h5,
h6 {
  margin-top: 10.5px;
  margin-bottom: 10.5px;
}
h1 {
  font-size: 3em; 
/*   font-size: 39px;  */
}
h2 {
  font-size: 32px;
}
h3 {
  font-size: 26px;
}
h4 {
  font-size: 19px;
}
h5 {
  font-size: 15px;
}
h6 {
  font-size: 13px;
}

/* plain paragraph text */
.paragraph {
/*   font-family: sans-serif; */
  margin: 0 0 10.5px;
}
p {
/*   font-family: sans-serif; */
  margin: 0 0 10.5px;
}

/* blockquote text */
.quoteblock {
  font-style: italic;
}
blockquote {
  padding: 10.5px 21px;
  margin: 0 0 21px;
  font-size: 18.75px;
  border-left: 5px solid #ecf0f1;
}
blockquote p:last-child,
blockquote ul:last-child,
blockquote ol:last-child {
  margin-bottom: 0;
}
.blockquote-reverse,
blockquote.pull-right {
  padding-right: 15px;
  padding-left: 0;
  border-right: 5px solid #ecf0f1;
  border-left: 0;
  text-align: right;
}
.blockquote-reverse footer:before,
blockquote.pull-right footer:before,
.blockquote-reverse small:before,
blockquote.pull-right small:before,
.blockquote-reverse .small:before,
blockquote.pull-right .small:before {
  content: '';
}
.blockquote-reverse footer:after,
blockquote.pull-right footer:after,
.blockquote-reverse small:after,
blockquote.pull-right small:after,
.blockquote-reverse .small:after,
blockquote.pull-right .small:after {
  content: '\00A0 \2014';
}

/* blockquote attribution text */
.attribution,
.cite,
blockquote footer,
blockquote small,
blockquote .small {
  display: block;
  font-size: 80%;
  line-height: 1.42857143;
  color: #b4bcc2;
}
.attribution:before,
blockquote footer:before,
blockquote small:before,
blockquote .small:before {
  content: '\2014 \00A0';
}

/* unordered list */
ul, ol {
  margin-top: 0;
  margin-bottom: 10.5px;
}
ul ul,
ol ul,
ul ol,
ol ol {
  margin-bottom: 0;
}


/* links */
a {
  color: #18bc9c;
  background-color: transparent;
  text-decoration: none;
}
a:hover,
a:focus {
  color: #18bc9c;
  text-decoration: underline;
}
a:focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}

/* horizontal rules */
hr {
  margin-top: 21px;
  margin-bottom: 21px;
  border: 0;
  border-top: 1px solid #ecf0f1;
}

/* table */
table {
  background-color: transparent;
  width: 100%;
  max-width: 100%;
  margin-bottom: 21px;
  border-collapse: collapse;
}
table col[class*="col-"] {
  position: static;
  float: none;
  display: table-column;
}
table td[class*="col-"],
table th[class*="col-"] {
  position: static;
  float: none;
  display: table-cell;
}

/* table caption */
caption {
  padding-top: 8px;
  padding-bottom: 8px;
  color: #b4bcc2;
  text-align: left;
}

/* table header row */
thead {
  border-bottom: 2px solid #ecf0f1;
}

/* table header cell */
th {
  text-align: left;
  padding-left: 8px;
}

/* table footer */
tfoot {
  color: #807F81;
  border-top: 1px solid #ecf0f1;
}

/* table cell */
td {
  border-top: 1px solid #ecf0f1;
}
td p {
  margin: auto;
  padding: 8px;
}

/* table body */
tbody > tr:nth-of-type(odd) {
  background-color: #f9f9f9;
}
tbody > tr:hover {
  background-color: #ecf0f1;
}

/* inline code */
code,
kbd,
pre,
samp {
  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
}
code {
  padding: 2px 4px;
  font-size: 90%;
  color: #c7254e;
  background-color: #f9f2f4;
  border-radius: 4px;  
}
kbd {
  padding: 2px 4px;
  font-size: 90%;
  color: #ffffff;
  background-color: #333333;
  border-radius: 0;
  -webkit-box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.25);
          box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.25);
}
kbd kbd {
  padding: 0;
  font-size: 100%;
  font-weight: bold;
  -webkit-box-shadow: none;
          box-shadow: none;
}
pre {
  display: block;
  padding: 10.5px;
  margin: 0 0 10.5px;
  font-size: 15px;
  line-height: 1.42857143;
  word-break: break-all;
  word-wrap: break-word;
  color: #333333;
  background-color: #f5f5f5;
  border: 1px solid #cccccc;
  border-radius: 4px;
}
pre code {
  padding: 0;
  font-size: inherit;
  color: inherit;
  white-space: pre-wrap;
  background-color: transparent;
  border-radius: 0;
}

/* image */
img {
  max-width: 100%;
  vertical-align: middle;
}

/* footer section */
#footer {
  margin-top: 22px;
  padding: 14px 16px;
  color: white;
  background-color: #2c3e50;
}

/* responsiveness fixes */
video {
  max-width: 100%;
}

/* table of Contents sidebar */
#toctitle {
  color: #ffffff;
}

#toc ul {
  display: inline;
  list-style-type: none;
  margin: 0;
  padding: 0;
  overflow: hidden;
}

#toc li {
  display: block;
}

#toc a {
  background-color: #2c3e50;
  float: left;
  color: white;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
}

#toc li a:hover {
  background-color: #1a242f;
  text-decoration: none;
}

#toc:after {
  content: " ";
  visibility: hidden;
  display: block;
  height: 0;
  clear: both;
}

@media all and (max-width: 600px) {
table {
  width: 55vw!important;
  font-size: 3vw;
}

</style>
</head>
<body class="article">
<div id="header">
<h1>Kubernetes Domains - Deepdive</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, we will deepdive into the various competency domains within kubernetes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_learning_outcomes">Learning Outcomes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After completing the lab, you will be able to understand and use Kubernetes concepts based on use-case scenarios in the following domains:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Core Concepts</p>
</li>
<li>
<p>Configuration</p>
</li>
<li>
<p>Multi-Container Pods</p>
</li>
<li>
<p>Observability</p>
</li>
<li>
<p>Pod Design</p>
</li>
<li>
<p>Services &amp; Networking</p>
</li>
<li>
<p>State Persistence</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_start_the_minikube">Start the minikube</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start minikube locally
<code>minikube start --driver=virtualbox</code></p>
</li>
<li>
<p>Verify the kubectl context <code>kubectl config get-contexts</code> is set to minikube. If not, set it to minikube <code>kubectl config use-context minikube</code></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deep_dive_scenarios">Deep-dive scenarios</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a busybox pod which prints "Hello from pages Yellow Pages" on the console</p>
</li>
<li>
<p>Create a busybox pod which prints "Hello from pages Yellow Pages" on the console, for every 10 seconds infinitely</p>
</li>
<li>
<p>Create an nginx pod and test it in the browser</p>
</li>
<li>
<p>Create a busybox pod which prints the output of nginx pod for every 10 seconds</p>
</li>
<li>
<p>Create a busybox pod which prints the <code>current date</code> on the console  - Instructions</p>
</li>
<li>
<p>Create a busybox pod which prints <code>current date</code> on the console, for every 10 seconds infinitely  - Instructions</p>
</li>
<li>
<p>Create an nginx pod and test it in the browser  - Instructions</p>
</li>
<li>
<p>Create a busybox pod which prints the output of <code>pages application</code> for every 10 seconds infinitely  - Instructions</p>
</li>
<li>
<p>Create environment variables for busybox pod with key=<code>course</code> and value=<code>K8s</code>
Verify the environment variables are set properly</p>
</li>
<li>
<p>Create environment variables for pages application with key=<code>PAGE_CONTENT</code> and value=<code>Hello from pages environment</code>
Verify the environment variables are set properly  - Instructions</p>
</li>
<li>
<p>Create a simple web server that starts serving traffic after some delay while the application starts up. If we didn&#8217;t configure our
readiness probe, Kubernetes would either start sending traffic to the container before we&#8217;re ready, or it would mark the pod as unhealthy and never send it traffic. Use the image <code>python:2.7-alpine</code></p>
</li>
<li>
<p>In the previous scenario add a liveness probe of type exec command to check if index.html exists whose exit code determines the sucess of the probe.</p>
</li>
<li>
<p>Configure liveness and readiness probe for pages application and verify - Instructions</p>
</li>
<li>
<p>Create a pod with a container that writes the current date to a file in a mounted volume at /etc/kal-directory/date-file.txt every five seconds. The created file should have the user ID 45 and the group ID 231 which will be useful for auditing and tracking files system updates. Use alpine image.</p>
</li>
<li>
<p>Create a pod that defines an application container which writes the current date to a log file every five seconds. The sidecar container is nginx serving that log file in a shared directory.</p>
</li>
<li>
<p>Create a pod that defines the pages application container which writes the logs to a file. Create a sidecar container serving that log file in a shared directory - Instructions</p>
</li>
<li>
<p>Create a pod that defines an application container which writes the current date and memory usage to a log file every five seconds. The adapter container will inspect the contents of the app&#8217;s log file, reformat it, and write the correctly formatted output to a new file</p>
<div class="paragraph">
<p>HINT: <code>free -tw --giga</code></p>
</div>
<div class="paragraph">
<p>Adapter Input Sample</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Thu Mar <span style="color:#00D">4</span> <span style="color:#00D">11</span>:<span style="color:#00D">26</span>:<span style="color:#00D">28</span> GMT <span style="color:#00D">2021</span>
              total        used        free      shared     buffers       cache   available
Mem:             <span style="color:#00D">32</span>           <span style="color:#00D">9</span>          <span style="color:#00D">10</span>           <span style="color:#00D">0</span>           <span style="color:#00D">0</span>          <span style="color:#00D">11</span>          <span style="color:#00D">22</span>
Swap:             <span style="color:#00D">2</span>           <span style="color:#00D">0</span>           <span style="color:#00D">2</span>
Total:           <span style="color:#00D">34</span>           <span style="color:#00D">9</span>          <span style="color:#00D">12</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Adapter Output Sample</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#0a8;font-weight:bold">Date</span>: Thu Mar  <span style="color:#00D">4</span> <span style="color:#00D">09</span>:<span style="color:#00D">36</span>:<span style="color:#00D">42</span> UTC <span style="color:#00D">2021</span>
Total Memory: <span style="color:#00D">34</span>GB
Free Memory: <span style="color:#00D">12</span>GB</code></pre>
</div>
</div>
</li>
<li>
<p>Create a pod that defines an application container which writes the proccess to a file every five seconds. Create a adapter container that display the top 3 processes consuming maximum memory.</p>
<div class="paragraph">
<p>HINT: <code>ps -ao "user,comm,pid,pcpu,pmem,start,time" --sort=pmem</code></p>
</div>
<div class="paragraph">
<p>Sample Output</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">USER     COMMAND           PID %CPU %MEM  STARTED     TIME
student  java            <span style="color:#00D">16213</span>  <span style="color:#60E">2.7</span>  <span style="color:#60E">3.7</span> <span style="color:#40E">07</span>:<span style="color:#00D">34</span>:<span style="color:#00D">42</span> <span style="color:#40E">00</span>:<span style="color:#40E">06</span>:<span style="color:#00D">47</span>
student  gnome-shell      <span style="color:#00D">2373</span> <span style="color:#60E">21.7</span>  <span style="color:#60E">1.7</span>   Feb <span style="color:#00D">22</span> <span style="color:#00D">2</span>-<span style="color:#40E">04</span>:<span style="color:#40E">02</span>:<span style="color:#00D">42</span>
student  chrome          <span style="color:#00D">14101</span>  <span style="color:#60E">1.3</span>  <span style="color:#60E">1.1</span> <span style="color:#00D">13</span>:<span style="color:#00D">09</span>:<span style="color:#00D">55</span> <span style="color:#40E">00</span>:<span style="color:#00D">17</span>:<span style="color:#00D">56</span></code></pre>
</div>
</div>
</li>
<li>
<p>Add a label <code>tier=service</code> to the pages application and display the label</p>
</li>
<li>
<p>Create a pod nginx and add a label <code>tier=frontend</code></p>
</li>
<li>
<p>Get all the pods with label <code>tier=frontend</code></p>
</li>
<li>
<p>Get all the pods which has label tier set to any value</p>
</li>
<li>
<p>Create a service which routes the request to nginx pod using selectors in the yaml file</p>
</li>
<li>
<p>Annotate nginx pod with annotation <code>team=yourteam</code> and <code>course=k8s</code></p>
</li>
<li>
<p>Create pages deployment with 2 replicas imperatively</p>
</li>
<li>
<p>Create pages deployment with 2 replicas using yaml manifest file</p>
</li>
<li>
<p>Verify the first version of deployment has been deployed and rolled out</p>
</li>
<li>
<p>Update the manifest to use 3 replicas and image to use the latest version [TODO]</p>
</li>
<li>
<p>Verify the second version of deployment has been deployed and rolled out</p>
</li>
<li>
<p>Rollback to the previous version</p>
</li>
<li>
<p>Manually scale to use 5 replicas</p>
</li>
<li>
<p>Manually scale to use 1 replica</p>
</li>
<li>
<p>Create a service (color) of type nodeport and expose port 8080 and target port 80, with the selector app=colorful</p>
</li>
<li>
<p>Create an nginx deployment which prints echo Green &gt; /usr/share/nginx/html/index.html &amp; expose on port 80 and label app=colorful</p>
</li>
<li>
<p>Create an nginx deployment which prints echo "Color: Blue" &gt; /usr/share/nginx/html/index.html &amp; expose on port 80 label app=colorful</p>
</li>
<li>
<p>Create a Persistent Volume which is used as a long term storage solution. Create a Persistent Volume Claim to use the persistent volume. Create a pod that defines an application container which writes the current date to a log file every five seconds and this pod will eventuall use persistent volume claim when mounting the log file to persistent volume.</p>
</li>
<li>
<p>Refactor question number 4 of Multicontainer section to mount the files on Persistent Volume. Create required Persistent Volume and Persistent Volume Claim. Storage capacity of Persistent Volume shoud not exceed 500M - Instructions</p>
</li>
<li>
<p>Create a pod that writes Pages application logs to a log file. Create a Persistent Volume and Persistent Volume claim to mount the pages application log file. - Instructions</p>
</li>
<li>
<p>Create a ConfigMap from literal values with key='course' and value='k8s' imperatively. Create environment variables for nginx pod with key=<code>course</code> and value to be read from the configmap.
Hint: <code>configMapKeyRef</code></p>
</li>
<li>
<p>Create a ConfigMap from literal values with key='PAGE_CONTENT' and value='Hello from pages environment' imperatively. Create environment variables for pages aplication with key=<code>PAGE_CONTENT</code> and value to be read from the configmap. - Instructions</p>
</li>
<li>
<p>Create the above ConfigMap using yaml. Create a nginx pod and read the environment variables key and value from ConfigMap
hint: configMapRef</p>
</li>
<li>
<p>Create the above ConfigMap using yaml. Create a nginx pod and read the environment variables key and value from ConfigMap. - Instructions</p>
</li>
<li>
<p>Create a ConfigMap from a properties file with key='course' and value='k8s' imperatively. Create a nginx pod and mount the configmap as a volume.</p>
</li>
<li>
<p>Create a configMap from application.properties used by Pages application. Mount this configmap as a volume while creating pod for pages application - Instructions</p>
</li>
<li>
<p>Create a secret from literal value with key='my-token' and value=base 64 encoded value of 'token-e8ujdekdjueke' imperatively. Create environment variable for nginx pod with key='my-token' and value to be read from the secret.
Hint: <code>secretMapKeyRef</code></p>
</li>
<li>
<p>Create a secret from literal values with key='password' and value=base 64 encoded value of 'admin@123' imperatively. Create environment for Pages application with key='password' and value to be read from the secret. - Instructions</p>
</li>
<li>
<p>Create the above secret from a properties file with key='password' and value=base 64 encoded value of 'admin@123'. Mount this secret as a volume while creating an nginx pod. - Instructions</p>
</li>
<li>
<p>Create a service (color) of type nodeport and expose port 8080 and target port 80, with the selector app=colorful</p>
</li>
<li>
<p>Create an nginx deployment which prints echo Green &gt; /usr/share/nginx/html/index.html &amp; expose on port 80 and label app=colorful</p>
</li>
<li>
<p>Create an nginx deployment which prints <code>echo "Color: Blue" &gt; /usr/share/nginx/html/index.html</code> &amp; expose on port 80 label <code>app=colorful</code></p>
</li>
<li>
<p>Create a job to print current date and time</p>
</li>
<li>
<p>Create a job to calculate the value of pi upto 1000 digits and print the output in command line. Use Perl to calculate.</p>
</li>
<li>
<p>Create a job which runs a workload which simulates rolling the dice and returns a zero exit code (i.e. success) when you get a six.</p>
</li>
<li>
<p>Create a CronJob that will ping Github every minute and check that their site hasn&#8217;t gone down. You can use alpine image.</p>
<div class="paragraph">
<p><code>image: alpine</code></p>
</div>
<div class="paragraph">
<p><code>command: ["/bin/sh"]</code></p>
</div>
<div class="paragraph">
<p><code>args: ["-c", "ping -w 1 github.com"]</code></p>
</div>
</li>
<li>
<p>Create a cron job to print current date and time every minute</p>
</li>
<li>
<p>Create a cron job to print "Time: 3.30 pm. It is break time. Lets stretch out a bit or have a coffee!" at 3.30pm today</p>
</li>
<li>
<p>Create a namespace called alpha imperatively &amp; declaratively</p>
</li>
<li>
<p>Create a namespace called angel declaratively &amp; declaratively</p>
</li>
<li>
<p>Create a resource quota in the namespace alpha with the below requirement. After creating the quota, Create an nginx pod within alpha and should you get an error, try to troubleshoot and solve it</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#F00;background-color:#FAA">pods:5</span>
<span style="color:#606"><span style="color:#404">&quot;</span><span>requests.cpu</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">2</span><span style="color:#710">&quot;</span></span>
<span style="color:#606"><span style="color:#404">&quot;</span><span>requests.memory</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1024m</span></span>
<span style="color:#606"><span style="color:#404">&quot;</span><span>limits.cpu</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">4</span><span style="color:#710">&quot;</span></span>
<span style="color:#606"><span style="color:#404">&quot;</span><span>limits.memory</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">2048m</span></span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<script>
(function(){

	// Get the elements.
	// - the 'pre' element.
	// - the 'div' with the 'paste-content' id.

	var pre = document.getElementsByTagName('pre');
	var pasteContent = document.getElementById('paste-content');

	// Add a copy button in the 'pre' element.
	// which only has the className of 'language-'.

	for (var i = 0; i < pre.length; i++) {
		var isLanguage = pre[i].children[0].className.indexOf('language-');

		if ( isLanguage === 0 ) {
			var button  = document.createElement('button');
			button.className = 'copy-button';
			button.textContent = 'COPY';
			button.style.float = 'right';

            var image = document.createElement('img');
			image.src = "clipboard.svg";
			image.width = "21";
			image.height = "27";

			button.appendChild(image);
			pre[i].appendChild(button);

		}
	};

	// Run Clipboard

	var copyCode = new Clipboard('.copy-button', {
		target: function(trigger) {
			return trigger.previousElementSibling;
    }
	});

	// On success:
	// - Change the "Copy" text to "Copied".
	// - Swap it to "Copy" in 2s.
	// - Lead user to the "contenteditable" area with Velocity scroll.

	copyCode.on('success', function(event) {
		event.clearSelection();
		//event.trigger.textContent = 'Copied';
		event.trigger.firstChild.textContent = 'Copied!';

		window.setTimeout(function () {
            event.trigger.firstChild.textContent = 'COPY';
		}, 2000);

		$.Velocity(pasteContent, 'scroll', {
			duration: 1000
		});
	});

	// On error (Safari):
	// - Change the  "Press Ctrl+C to copy"
	// - Swap it to "Copy" in 2s.

	copyCode.on('error', function(event) {
		event.trigger.textContent = 'Press "Ctrl + C" to copy';
		window.setTimeout(function() {
			event.trigger.textContent = 'Copy';
		}, 5000);
	});



})();
</script>
<!--analytics-->
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
</body>
</html>